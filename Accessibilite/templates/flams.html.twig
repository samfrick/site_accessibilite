{% extends "base.html.twig" %}
{% block title %}Flam's{% endblock %}

{% block main %}
<!-- Début du fil d'arianne -->
<nav class="flex text-sm text-gray-600 mt-4" aria-label="Fil d'Ariane">
    <ol class="inline-flex items-center space-x-1 md:space-x-3">

        <li class="inline-flex items-center">
            <a href="{{ path('home') }}"
                class="inline-flex items-center text-gray-600 hover:text-[#3ca0e7] focus:text-[#3ca0e7]">
                Accueil
            </a>
            <span class="mx-2 text-gray-400">></span>
        </li>

        <li class="relative group focus-within:z-20">
            <div class="flex items-center">
                <p aria-haspopup="menu" aria-expanded="false" class="ml-1 text-gray-600">Flams</p>
            </div>
        </li>
    </ol>
</nav>

<!-- Contenu principal de la page -->
<div id="mainContent" class="text-center w-[80%] flex flex-col items-center mx-auto">
    <h1 class="h1 font-bold">Bienvenue sur la page dédiée aux Flam's</h1>
    <h2 class="h2">Composez votre tarte</h2>

    <form action="{{ path('flams') }}" method="post" class="form mb-8 text-left">
        <div class="fieldset">
            <label for="taille" class="legend h3">Choisissez la taille de votre tarte :</label>
            <select id="taille" name="taille" class="border border-gray-300 rounded py-1 px-2">
                <optgroup label="Taille">
                    <option value="petite">Petite</option>
                    <option value="moyenne">Moyenne</option>
                    <option value="grande">Grande</option>
                </optgroup>
            </select>
        </div>
        <fieldset class="fieldset">
            <legend class="legend h3">Choisissez les ingrédients :</legend>
            <div class="grid grid-cols-2 gap-4">
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/lardon_flams.jpg" alt="Lardons" class="img-ingredient">
                    <label for="lardons">Lardons</label>
                    <input type="checkbox" id="lardons" name="ingredients" value="lardons">
                </div>
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/crème_flams.jpg" alt="Crème" class="img-ingredient">
                    <label for="crème">Crème</label>
                    <input type="checkbox" id="crème" name="ingredients" value="crème">
                </div>
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/fromage_flams.jpg" alt="Fromage" class="img-ingredient">
                    <label for="fromage">Fromage</label>
                    <input type="checkbox" id="fromage" name="ingredients" value="fromage">
                </div>
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/champignon_flams.jpg" alt="Champignons" class="img-ingredient">
                    <label for="champignons">Champignons</label>
                    <input type="checkbox" id="champignons" name="ingredients" value="champignons">
                </div>
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/munster_flams.jpg" alt="Munster" class="img-ingredient">
                    <label for="munster">Munster</label>
                    <input type="checkbox" id="munster" name="ingredients" value="munster">
                </div>
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/patate_flams.jpg" alt="Pommes de terre" class="img-ingredient">
                    <label for="patates">Pommes de terre</label>
                    <input type="checkbox" id="patates" name="ingredients" value="patates">
                </div>
            </div>
        </fieldset>
        <fieldset class="fieldset">
            <legend class="legend h3">Choisissez les toppings :</legend>
            <div class="grid grid-cols-2 gap-4">
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/persil_flams.jpg" alt="Persil" class="img-ingredient">
                    <label for="persil">Persil</label>
                    <input type="checkbox" id="persil" name="toppings" value="persil">
                </div>
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/poivre_flams.jpg" alt="Poivre" class="img-ingredient">
                    <label for="poivre">Poivre</label>
                    <input type="checkbox" id="poivre" name="toppings" value="poivre">
                </div>
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/oignon_flams.jpg" alt="Oignons" class="img-ingredient">
                    <label for="oignons">Oignons</label>
                    <input type="checkbox" id="oignons" name="toppings" value="oignons">
                </div>
                <div role="group" aria-labelledby="label-id">
                    <img src="/uploads/flams/echalote_flams.jpg" alt="Échalotes" class="img-ingredient">
                    <label for="échalotes">Échalotes</label>
                    <input type="checkbox" id="échalotes" name="toppings" value="échalotes">
                </div>
            </div>
        </fieldset>
        <button class="btn btn-secondary" type="submit">Valider la composition de ma flams</button>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('.form');

        form.addEventListener('submit', function (e) {
            e.preventDefault(); // empêche l’envoi classique du formulaire

            // Récupère la taille
            const taille = document.getElementById('taille').value;

            // Récupère les ingrédients cochés
            const ingredients = Array.from(document.querySelectorAll('input[name="ingredients"]:checked'))
                .map(el => el.value);

            // Récupère les toppings cochés
            const toppings = Array.from(document.querySelectorAll('input[name="toppings"]:checked'))
                .map(el => el.value);

            // Sauvegarde dans localStorage
            localStorage.setItem('flam_taille', taille);
            localStorage.setItem('flam_ingredients', JSON.stringify(ingredients));
            localStorage.setItem('flam_toppings', JSON.stringify(toppings));

            // Redirige vers la page de résumé
            window.location.href = "{{ path('flams_summary') }}";
        });
    });
</script>
{% endblock main %}